---
import Layout from "../../layouts/Layout.astro";

export async function getStaticPaths() {
  // Return empty array for build - pages will be client-rendered
  return [];
}
---

<Layout title="Détail du sondage - KoproGo">
  <div class="container mx-auto px-4 py-8">
    <div class="mb-6">
      <a
        href="/polls"
        class="inline-flex items-center text-blue-600 hover:text-blue-800"
      >
        ← Retour aux sondages
      </a>
    </div>

    <div id="poll-detail-container"></div>
  </div>
</Layout>

<script>
  import { mount } from "svelte";
  import PollDetail from "../../components/polls/PollDetail.svelte";
  import { authStore } from "../../stores/auth";
  import { UserRole } from "../../lib/types";
  import { get } from "svelte/store";

  const auth = get(authStore);
  const currentUserId = auth.user?.id || "";
  const isAdmin =
    auth.user?.role === UserRole.SYNDIC ||
    auth.user?.role === UserRole.SUPERADMIN;

  // Extract poll ID from URL
  const pathParts = window.location.pathname.split("/");
  const pollId = pathParts[pathParts.length - 1];

  // Mount Poll Detail
  const detailContainer = document.getElementById("poll-detail-container");
  if (detailContainer && pollId) {
    mount(PollDetail, {
      target: detailContainer,
      props: {
        pollId: pollId,
        currentUserId: currentUserId,
        isAdmin: isAdmin,
      },
    });
  }
</script>

---
import Layout from "../../layouts/Layout.astro";
---

<Layout title="DÃ©tails de la campagne - KoproGo">
  <div class="container mx-auto px-4 py-8 max-w-6xl">
    <div class="mb-6">
      <a
        href="/energy-campaigns"
        class="inline-flex items-center text-blue-600 hover:text-blue-800"
      >
        &larr; Retour aux campagnes
      </a>
    </div>

    <div id="campaign-detail-container"></div>
  </div>
</Layout>

<script>
  import { mount } from "svelte";
  import CampaignDetail from "../../components/energy-campaigns/CampaignDetail.svelte";
  import { authStore } from "../../stores/auth";
  import { UserRole } from "../../lib/types";
  import { get } from "svelte/store";

  const auth = get(authStore);
  const currentUserId = auth.user?.id || "";
  const currentUnitId = undefined; // TODO: Get unit_id from context
  const isAdmin = auth.user?.role === UserRole.SUPERADMIN || auth.user?.role === UserRole.SYNDIC;

  // Extract campaign ID from query parameter
  const params = new URLSearchParams(window.location.search);
  const campaignId = params.get("id");

  const container = document.getElementById("campaign-detail-container");
  if (container && campaignId) {
    mount(CampaignDetail, {
      target: container,
      props: {
        campaignId: campaignId,
        currentUserId: currentUserId,
        currentUnitId: currentUnitId,
        isAdmin: isAdmin,
      },
    });
  }
</script>

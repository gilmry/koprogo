---
import Layout from "../../layouts/Layout.astro";
---

<Layout title="Créer une campagne d'achat groupé - KoproGo">
  <div class="container mx-auto px-4 py-8 max-w-3xl">
    <div class="mb-6">
      <a
        href="/energy-campaigns"
        class="text-sm text-indigo-600 hover:text-indigo-800 underline mb-4 inline-block"
      >
        ← Retour aux campagnes
      </a>
      <h1 class="text-3xl font-bold text-gray-900">
        Créer une campagne d'achat groupé d'énergie
      </h1>
      <p class="text-gray-600 mt-2">
        Lancez une nouvelle campagne pour négocier collectivement vos contrats
        d'énergie.
      </p>
    </div>

    <div id="create-form-container"></div>
  </div>
</Layout>

<script>
  import { mount } from "svelte";
  import CreateCampaignForm from "../../components/energy-campaigns/CreateCampaignForm.svelte";
  import { authStore } from "../../stores/auth";
  import { get } from "svelte/store";

  const auth = get(authStore);
  const organizationId = auth.user?.organizationId || "";

  const formContainer = document.getElementById("create-form-container");
  if (formContainer) {
    mount(CreateCampaignForm, {
      target: formContainer,
      props: {
        organizationId: organizationId,
        onCreated: (campaign: any) => {
          setTimeout(() => {
            window.location.href = `/energy-campaigns/detail?id=${campaign.id}`;
          }, 2000);
        },
        onCancel: () => {
          window.location.href = "/energy-campaigns";
        },
      },
    });
  }
</script>

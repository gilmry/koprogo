---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Gamification - KoproGo">
  <div class="container mx-auto px-4 py-8">
    <div class="mb-6">
      <h1 class="text-3xl font-bold text-gray-900">
        Gamification
      </h1>
      <p class="text-gray-600 mt-2">
        Gagnez des achievements, relevez des challenges et grimpez dans le classement de votre copropriété.
      </p>
    </div>

    <!-- Stats banner -->
    <div id="gamification-stats" class="mb-6"></div>

    <!-- Main grid: achievements + sidebar -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Achievements (2/3) -->
      <div class="lg:col-span-2 space-y-6">
        <div id="achievement-list"></div>
        <div id="challenge-list"></div>
      </div>

      <!-- Sidebar (1/3) -->
      <div class="space-y-6">
        <div id="gamification-leaderboard"></div>
      </div>
    </div>
  </div>
</Layout>

<script>
  import { mount } from "svelte";
  import AchievementList from "../components/gamification/AchievementList.svelte";
  import ChallengeList from "../components/gamification/ChallengeList.svelte";
  import GamificationLeaderboard from "../components/gamification/GamificationLeaderboard.svelte";
  import { authStore } from "../stores/auth";
  import { get } from "svelte/store";

  const auth = get(authStore);
  const organizationId = auth.user?.organizationId || auth.user?.activeRole?.organizationId || "";

  const achContainer = document.getElementById("achievement-list");
  if (achContainer) {
    mount(AchievementList, {
      target: achContainer,
      props: { organizationId },
    });
  }

  const chalContainer = document.getElementById("challenge-list");
  if (chalContainer) {
    mount(ChallengeList, {
      target: chalContainer,
      props: { organizationId },
    });
  }

  const lbContainer = document.getElementById("gamification-leaderboard");
  if (lbContainer) {
    mount(GamificationLeaderboard, {
      target: lbContainer,
      props: { organizationId },
    });
  }
</script>

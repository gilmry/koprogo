---
import BaseLayout from "../../layouts/BaseLayout.astro";
---

<BaseLayout title="Compare Quotes">
  <div class="container mx-auto px-4 py-8">
    <div class="mb-6">
      <a
        href="/quotes"
        class="inline-flex items-center text-sm font-medium text-gray-500 hover:text-gray-700 mb-4"
      >
        <svg
          class="mr-2 h-5 w-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 19l-7-7 7-7"
          />
        </svg>
        Back to Quotes
      </a>
      <h1 class="text-3xl font-bold text-gray-900">Compare Contractor Quotes</h1>
      <p class="mt-2 text-gray-600">
        Belgian legal requirement: compare at least 3 quotes for works exceeding 5,000â‚¬
      </p>
    </div>

    <!-- Belgian Law Notice -->
    <div class="mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
      <div class="flex">
        <div class="flex-shrink-0">
          <svg
            class="h-5 w-5 text-blue-400"
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path
              fill-rule="evenodd"
              d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
              clip-rule="evenodd"
            />
          </svg>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-blue-800">
            ðŸ‡§ðŸ‡ª Belgian CopropriÃ©tÃ© Law
          </h3>
          <div class="mt-2 text-sm text-blue-700">
            <p>
              For construction or repair works exceeding 5,000â‚¬, Belgian law requires
              obtaining at least <strong>3 comparable quotes</strong> from different
              contractors. This ensures transparency and fair pricing for all co-owners.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Quote Comparison Component -->
    <div id="quote-comparison"></div>
  </div>
</BaseLayout>

<script>
  import { mount } from "svelte";
  import QuoteComparisonTable from "../../components/quotes/QuoteComparisonTable.svelte";

  // Get quote IDs from URL query params
  const params = new URLSearchParams(window.location.search);
  const quoteIdsParam = params.get("ids");

  if (quoteIdsParam) {
    const quoteIds = quoteIdsParam.split(",");

    if (quoteIds.length >= 2) {
      // Mount comparison table
      const comparisonContainer = document.getElementById("quote-comparison");
      if (comparisonContainer) {
        mount(QuoteComparisonTable, {
          target: comparisonContainer,
          props: {
            quoteIds,
          },
        });
      }
    } else {
      // Show error if less than 2 quotes
      document.getElementById("quote-comparison").innerHTML = `
        <div class="bg-red-50 border border-red-200 rounded-lg p-6">
          <h3 class="text-lg font-semibold text-red-900 mb-2">Insufficient Quotes</h3>
          <p class="text-red-700">You need at least 2 quotes to compare. Please select more quotes.</p>
          <a href="/quotes" class="mt-4 inline-block px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">
            Back to Quotes
          </a>
        </div>
      `;
    }
  } else {
    // Show error if no quote IDs provided
    document.getElementById("quote-comparison").innerHTML = `
      <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6">
        <h3 class="text-lg font-semibold text-yellow-900 mb-2">No Quotes Selected</h3>
        <p class="text-yellow-700">Please select quotes to compare from the quotes list.</p>
        <a href="/quotes" class="mt-4 inline-block px-4 py-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700">
          Go to Quotes
        </a>
      </div>
    `;
  }
</script>

################################################################################
# KoproGo Production Environment Variables
#
# Ce fichier contient TOUTES les variables d'environnement nécessaires pour
# déployer KoproGo en production sur un VPS OVH.
#
# IMPORTANT: Copier ce fichier en .env et remplir avec vos valeurs réelles.
# Ne JAMAIS commiter le fichier .env avec des valeurs sensibles !
#
# Usage:
#   cp .env.production.example .env
#   nano .env  # Éditer les valeurs
#   docker compose up -d
################################################################################

##############################################################################
# DOMAINES & SSL
##############################################################################

# Domaine principal du frontend (app.koprogo.com ou koprogo.com)
FRONTEND_DOMAIN=koprogo.com

# Domaine de l'API backend (api.koprogo.com ou koprogo.com/api)
API_DOMAIN=koprogo.com

# Email pour Let's Encrypt (notifications expiration certificats)
ACME_EMAIL=contact@koprogo.com

##############################################################################
# BASE DE DONNÉES POSTGRESQL
##############################################################################

# ⚠️ CRITIQUE: Changer ce mot de passe en production !
POSTGRES_PASSWORD=CHANGEME_STRONG_PASSWORD_HERE

##############################################################################
# BACKEND - SÉCURITÉ & JWT
##############################################################################

# ⚠️ CRITIQUE: Secret JWT pour authentification (générer avec openssl rand -hex 32)
JWT_SECRET=CHANGEME_GENERATE_WITH_openssl_rand_hex_32

##############################################################################
# BACKEND - CONFIGURATION
##############################################################################

# Niveau de logs (error, warn, info, debug, trace)
# Production: warn ou error uniquement
RUST_LOG=warn

# Backtrace Rust (0 = désactivé en production pour perfs)
RUST_BACKTRACE=0

# Nombre de workers Actix (1 pour VPS 1 vCPU)
ACTIX_WORKERS=1

# Origines CORS autorisées (séparées par virgules)
CORS_ALLOWED_ORIGINS=https://koprogo.com,https://www.koprogo.com

# Pool de connexions PostgreSQL (max 8 pour VPS 1 vCPU)
DB_POOL_MAX_CONNECTIONS=8
DB_POOL_MIN_CONNECTIONS=2

# Rate limiting (false si géré par Traefik/CrowdSec)
ENABLE_RATE_LIMITING=false

##############################################################################
# STOCKAGE DE FICHIERS (S3 / MinIO)
##############################################################################

# Provider de stockage: "s3" ou "local"
# s3 = MinIO auto-hébergé ou AWS S3
# local = stockage sur disque (non recommandé en production)
STORAGE_PROVIDER=s3

# Si STORAGE_PROVIDER=local, chemin des uploads
UPLOAD_DIR=/app/uploads

# Configuration S3 / MinIO
S3_BUCKET=koprogo-documents
S3_REGION=eu-west-0
S3_ENDPOINT=http://minio:9000
S3_ACCESS_KEY=CHANGEME_MINIO_ACCESS_KEY
S3_SECRET_KEY=CHANGEME_MINIO_SECRET_KEY
S3_FORCE_PATH_STYLE=true
S3_KEY_PREFIX=documents

# URL publique MinIO (pour génération de liens signés si exposé)
# Laisser vide si MinIO reste interne
S3_PUBLIC_ENDPOINT=
MINIO_CONSOLE_PUBLIC_URL=

# Bootstrap MinIO (true pour créer le bucket automatiquement)
ENABLE_MINIO_BOOTSTRAP=true

##############################################################################
# TRAEFIK - CONFIGURATION AVANCÉE (optionnel)
##############################################################################

# Niveau de logs Traefik (DEBUG, INFO, WARN, ERROR)
TRAEFIK_LOG_LEVEL=INFO

##############################################################################
# GITHUB / CI/CD (optionnel si utilisation GitHub Container Registry)
##############################################################################

# Repository GitHub pour images Docker (ex: gilmry/koprogo)
GITHUB_REPOSITORY=gilmry/koprogo

# Tag d'image Docker (latest, v1.0.0, main, etc.)
IMAGE_TAG=latest

##############################################################################
# RESSOURCES & PERFORMANCES (déjà configurées dans docker-compose.yml)
##############################################################################

# Ces valeurs sont dans docker-compose.yml mais peuvent être overridées ici
#
# Limites mémoire:
# - Traefik: 128M
# - Backend: 384M (réservation: 256M)
# - Frontend: 128M (réservation: 96M)
# - PostgreSQL: Pas de limite (tuning dans command)
#
# Limites CPU:
# - Traefik: 0.25 vCPU
# - Backend: 0.75 vCPU (réservation: 0.25)
# - Frontend: 0.5 vCPU (réservation: 0.125)

##############################################################################
# CHECKLIST PRÉ-DÉPLOIEMENT
##############################################################################

# ✅ DNS configuré (A record: koprogo.com -> IP VPS)
# ✅ Ports ouverts sur VPS (80, 443)
# ✅ POSTGRES_PASSWORD changé (fort)
# ✅ JWT_SECRET généré (openssl rand -hex 32)
# ✅ S3_ACCESS_KEY / S3_SECRET_KEY changés
# ✅ ACME_EMAIL configuré (notifications Let's Encrypt)
# ✅ CORS_ALLOWED_ORIGINS vérifié
# ✅ RUST_LOG = warn ou error
# ✅ Sauvegardes configurées (voir infrastructure/ansible/security-monitoring.yml)
# ✅ Monitoring Prometheus/Grafana configuré

##############################################################################
# GÉNÉRATION DE SECRETS
##############################################################################

# Générer JWT_SECRET:
#   openssl rand -hex 32
#
# Générer POSTGRES_PASSWORD:
#   openssl rand -base64 24
#
# Générer S3_ACCESS_KEY / S3_SECRET_KEY:
#   openssl rand -base64 20

##############################################################################
# COMMANDES UTILES
##############################################################################

# Démarrer en production:
#   docker compose -f docker-compose.yml up -d
#
# Voir les logs:
#   docker compose logs -f
#
# Redémarrer le backend:
#   docker compose restart backend
#
# Migrations PostgreSQL:
#   docker compose exec backend sqlx migrate run
#
# Backup PostgreSQL (si ansible non configuré):
#   docker compose exec postgres pg_dump -U koprogo koprogo_db > backup.sql

################################################################################
# KoproGo Production Environment Variables
# Generated by Ansible on {{ ansible_date_time.iso8601 }}
# Host: {{ ansible_host }}
################################################################################

# GitHub Container Registry
GITHUB_REPOSITORY={{ github_repository | default('gilmry/koprogo') }}
IMAGE_TAG={{ image_tag | default('latest') }}

# Traefik Configuration
ACME_EMAIL={{ acme_email | default('admin@example.com') }}
TRAEFIK_LOG_LEVEL={{ traefik_log_level | default('INFO') }}

# Domain Configuration
{% if api_domain and api_domain != '' %}
API_DOMAIN={{ api_domain }}
FRONTEND_DOMAIN={{ frontend_domain }}
{% else %}
API_DOMAIN={{ ansible_host }}
FRONTEND_DOMAIN={{ ansible_host }}
{% endif %}

# Database Configuration
POSTGRES_DB=koprogo_db
POSTGRES_USER=koprogo
POSTGRES_PASSWORD={{ postgres_password | default(lookup('password', '/dev/null chars=ascii_letters,digits length=32')) }}

# Backend Configuration
SERVER_HOST=0.0.0.0
SERVER_PORT=8080
RUST_LOG={{ rust_log | default('warn') }}
RUST_BACKTRACE={{ rust_backtrace | default('0') }}
ACTIX_WORKERS={{ actix_workers | default('1') }}
{% if frontend_domain and frontend_domain != '' %}
CORS_ALLOWED_ORIGINS=https://{{ frontend_domain }},https://{{ api_domain }}
{% else %}
CORS_ALLOWED_ORIGINS=http://{{ ansible_host }},http://{{ ansible_host }}:8080
{% endif %}
DB_POOL_MAX_CONNECTIONS={{ db_pool_max_connections | default('8') }}
DB_POOL_MIN_CONNECTIONS={{ db_pool_min_connections | default('2') }}
ENABLE_RATE_LIMITING={{ enable_rate_limiting | default('false') }}
JWT_SECRET={{ jwt_secret | default(lookup('password', '/dev/null chars=ascii_letters,digits length=64')) }}

# Frontend Configuration
{% if api_domain and api_domain != '' %}
PUBLIC_API_URL=https://{{ api_domain }}/api/v1
{% else %}
PUBLIC_API_URL=http://{{ ansible_host }}:8080/api/v1
{% endif %}

# Storage configuration
STORAGE_PROVIDER={{ storage_provider | default('s3') }}
UPLOAD_DIR={{ upload_dir | default('/app/uploads') }}
S3_BUCKET={{ s3_bucket | default('koprogo-documents') }}
S3_REGION={{ s3_region | default('eu-west-0') }}
S3_ENDPOINT={{ s3_endpoint | default('http://minio:9000') }}
S3_ACCESS_KEY={{ s3_access_key | default('') }}
S3_SECRET_KEY={{ s3_secret_key | default('') }}
S3_FORCE_PATH_STYLE={{ s3_force_path_style | default('true') }}
S3_KEY_PREFIX={{ s3_key_prefix | default('documents') }}
ENABLE_MINIO_BOOTSTRAP={{ enable_minio_bootstrap | default('true') }}

# Metrics endpoint protection (optional)
METRICS_AUTH_TOKEN={{ metrics_auth_token | default('') }}

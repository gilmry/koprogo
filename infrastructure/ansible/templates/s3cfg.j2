# s3cmd configuration for KoproGo backups
# Generated by Ansible

[default]
access_key = {{ s3_access_key }}
secret_key = {{ s3_secret_key }}
host_base = {{ s3_host_base | default('s3.eu-west-3.amazonaws.com') }}
host_bucket = {{ s3_host_bucket | default('%(bucket)s.s3.eu-west-3.amazonaws.com') }}
use_https = {{ s3_use_https | default('True') }}
bucket_location = {{ s3_region | default('eu-west-3') }}

# Enable server-side encryption
server_side_encryption = True

# Signature version (v4 required for newer regions)
signature_v2 = False

# Connection settings
socket_timeout = 300
use_mime_magic = True
preserve_attrs = True
recv_chunk = 65536
send_chunk = 65536
multipart_chunk_size_mb = 15
multipart_max_chunks = 10000

# For OVH Object Storage or other S3-compatible providers
{% if s3_provider == 'ovh' %}
host_base = s3.{{ s3_region }}.cloud.ovh.net
host_bucket = %(bucket)s.s3.{{ s3_region }}.cloud.ovh.net
{% elif s3_provider == 'scaleway' %}
host_base = s3.{{ s3_region }}.scw.cloud
host_bucket = %(bucket)s.s3.{{ s3_region }}.scw.cloud
{% elif s3_provider == 'backblaze' %}
host_base = s3.{{ s3_region }}.backblazeb2.com
host_bucket = %(bucket)s.s3.{{ s3_region }}.backblazeb2.com
{% endif %}
